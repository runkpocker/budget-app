<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Bunny Balut Budget</title>

  <?!= include('styles'); ?>

  <style>
    :root{
      --pad:16px;
      --radius:18px;
      --ink:#3b3532;
      --bg:#f7f4f1;
      --gap:12px;
    }

/* üî• Normalize ALL pill buttons (button + anchor) */
.pill,
button.pill,
a.pill {
  text-decoration: none !important;
  color: var(--ink) !important;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 18px 24px;
  border-radius: 999px;
  font-size: 1.3rem;
  font-weight: 700;
  line-height: 1.3;
  background:#efe9e2;
  border: 1px solid rgba(0,0,0,0.06);
}

/* Primary variant */
.pill.primary,
button.pill.primary,
a.pill.primary {
  background: #ebd8c5;
}
/* Make pill links behave like pill buttons */
a.pill {
  text-decoration: none !important;
  color: inherit !important;
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Remove visited/active weird colors */
a.pill:visited,
a.pill:active,
a.pill:hover {
  text-decoration: none !important;
  color: inherit !important;
}

    body{background:var(--bg);color:var(--ink);}
    .wrap{max-width:1100px;margin:28px auto 56px;padding:0 16px;}

    /* Header */
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:10px}
    .brand .bun{font-size:28px;}
    .brand h1{font-weight:700;font-size:clamp(22px,3.2vw,34px);margin:0}
    .tagline{margin:0 0 18px;opacity:.7;font-size:13.5px}

    /* Cards default */
    .cards{display:flex;flex-direction:column;gap:12px}
    .card{
      background:#fff;border-radius:var(--radius);
      box-shadow:0 6px 18px rgba(0,0,0,.06), inset 0 0 0 1px rgba(0,0,0,.05);
      padding:18px;position:relative
    }
    .kicker{font-weight:600;opacity:.75;font-size:13px}
    .card h3{margin:6px 0 6px;font-size:18px}
    .card p{margin:0 0 12px;opacity:.8}

    .pill{
      display:inline-flex;align-items:center;justify-content:center;
      padding:12px 16px;border-radius:999px;border:1px solid rgba(0,0,0,.06);
      background:#efe9e2;font-weight:700;cursor:pointer
    }
    .pill.primary{background:#ebd8c5}
    .ribbon{
      position:absolute;right:-48px;top:12px;transform:rotate(20deg);
      padding:6px 0;width:160px;text-align:center;border:1px dashed rgba(0,0,0,.15);
      background:#f3edd9;color:#6a615a;font-weight:700;font-size:12px
    }

    /* Desktop grid only when truly wide */
    @media (min-width:1280px){
      #landing .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    }

    /* ---------- Quick Add modal ---------- */
    .qa-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:flex-end;z-index:9998}
    .qa-overlay.open{display:flex;}
    .qa-sheet{
      width:100%;max-height:100vh;overflow:auto;background:#fff;
      border-top-left-radius:22px;border-top-right-radius:22px;
      padding:18px 16px 20px;z-index:9999;animation:slideUp .22s ease;
    }
    @keyframes slideUp{from{transform:translateY(16px);opacity:.85}to{transform:translateY(0);opacity:1}}
    @media (min-width:980px){
      .qa-overlay{align-items:center;justify-content:center}
      .qa-sheet{width:min(760px,92vw);max-height:86vh;border-radius:22px}
    }

    /* =========================================================
       TOUCH DEVICES: make cards tall AND scale inner typography
       ========================================================= */
    @media (hover:none) and (pointer:coarse){

      /* Bigger header for mobile */
      #landing .brand h1 {
        font-size: clamp(1.9rem, 3.2vh + 1.2rem, 3rem);
        font-weight: 800;
        line-height: 1.1;
      }

      #landing .brand .bun {
        font-size: clamp(2.2rem, 3.5vh + 0.8rem, 3.4rem);
      }

      #landing .tagline {
        font-size: clamp(1rem, 1.1vh + 0.6rem, 1.35rem);
        opacity: .8;
      }

      /* Full-viewport layout for landing so we can size cards */
      #landing.wrap{
        min-height:100svh; display:flex; flex-direction:column;
        margin:0; padding:8px 12px 12px; box-sizing:border-box;
      }
      #landing .brand{margin-bottom:4px}
      #landing .tagline{margin:0 0 8px}

      /* Column of 3 equal slices */
      #landing .cards{
        flex:1 1 auto; min-height:0; display:flex; flex-direction:column; gap:var(--gap);
      }
      #landing .cards > .card{
        width:100%; flex:1 1 0; min-height:22vh; /* fallback */
        display:flex; flex-direction:column; justify-content:center; padding:18px;
      }

      /* ===== Typography that scales with VIEWPORT HEIGHT =====
         These clamps win against base styles because of specificity.
         They track the big chunky cards so text feels proportionate. */
      #landing .cards > .card .kicker{
        font-size:clamp(60px, 1.2vh + 0.45rem, 18px);
        font-weight:700; opacity:.78;
      }
      #landing .cards > .card h3{
        font-size:clamp(40px, 4.6vh + 0.6rem, 28px);
        line-height:1.25; font-weight:800; margin:6px 0 8px;
      }
      #landing .cards > .card p{
        font-size:clamp(20px, 4.6vh + 0.45rem, 19px);
        line-height:1.4; opacity:.88; margin:0 0 14px;
      }
      #landing .cards > .card .pill{
        padding:clamp(40px, 1.3vh + 8px, 18px) clamp(16px, 1.2vh + 12px, 22px);
        font-size:clamp(60px, 1.4vh + 0.5rem, 18px);
        border-radius:999px; font-weight:800;
      }
    }

/* Tap target for the bunny */
.icon-btn{
  appearance:none;border:0;background:transparent;cursor:pointer;
  font-size:1.25em; line-height:1; margin-right:8px; transform-origin:center;
}
.icon-btn.bonk{ animation:egg-bonk .16s ease; }
@keyframes egg-bonk{ from{transform:scale(.9) rotate(-6deg)} to{transform:scale(1) rotate(0)} }

/* Overlay */
.egg-overlay{
  position:fixed; inset:0; display:none; z-index:9998;
  background:rgba(0,0,0,.45); backdrop-filter:blur(2px);
}
.egg-overlay.open{ display:flex; align-items:flex-end; }

/* Sheet (mobile bottom sheet, desktop centered) */
.egg-sheet{
  width:100%; max-height:90vh; overflow:auto; background:#fff;
  border-top-left-radius:22px; border-top-right-radius:22px;
  box-shadow:0 -16px 40px rgba(0,0,0,.28);
  padding:18px 16px 20px; animation:egg-up .22s ease;
}
@keyframes egg-up{ from{transform:translateY(14px); opacity:.9} to{transform:translateY(0); opacity:1} }

.egg-head{ display:flex; justify-content:center; margin-bottom:8px; }
.egg-grip{ width:48px; height:5px; border-radius:999px; background:#e6e1dc; opacity:.95; }

.egg-title{ text-align:center; margin:6px 0 10px; font-weight:800; }
.egg-body{ text-align:center; margin:0 0 8px; }
.egg-perks{ margin:8px 0 10px 18px; }
.egg-quote{
  margin:10px 0; padding:10px 12px; background:#fff7e9; border-left:4px solid #f1c27d;
  border-radius:10px;
}
.egg-actions{ display:flex; justify-content:center; }
.btn.primary{ background:#ebd8c5; border:1px solid rgba(0,0,0,.06); border-radius:999px; padding:12px 18px; font-weight:800; }

/* Desktop center */
@media (min-width:980px){
  .egg-overlay{ align-items:center; justify-content:center; }
  .egg-sheet{ width:min(640px,92vw); border-radius:22px; }
}

/* Make the bunny super tappable on phones */
.icon-btn{
  appearance:none;border:0;background:transparent;cursor:pointer;
  font-size:1.6em; line-height:1; margin-right:8px; transform-origin:center;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;           /* disables double-tap zoom */
  padding: 8px;                          /* bigger hit target */
  border-radius: 12px;                   /* nicer focus ring radius */
}
.icon-btn:focus-visible{ outline: 2px solid rgba(0,0,0,.25); outline-offset:2px; }

  </style>
</head>

<body>
  <div id="landing" class="wrap">
    <div class="brand">
      <div class="bun">üê∞</div>
      <h1>Bunny Balut Budget</h1>
    </div>
    <p class="tagline">Daddy owns you, and your budget üêæüêæ ‚Äî pick your adventure:</p>

    <div class="cards">
      <section class="card">
        <div class="kicker">‚ûï Quick Log</div>
        <h3>Log Your Purchase, Brat</h3>
        <p>Add a transaction fast.</p>
        <button class="pill primary" id="openQA">Open Quick Add</button>
      </section>

      <section class="card">
        <div class="kicker">üìä Dashboard</div>
        <h3>Bunny Dashboard &amp; Transactions</h3>
        <p>See Dashboard and transactions</p>
        <a class="pill primary"
          href="<?= BASE_URL ?>?view=index"
          target="_top" rel="noopener">Open Dashboard</a>
      </section>

      <section class="card">
<div class="kicker">
  <button id="eggBunny" class="icon-btn" type="button" aria-label="Secret bunny">üê∞</button>
  Profile
</div>
        <h3>Manage Bunny Info</h3>
        <p>Categories, accounts, preferences‚Ä¶ cozy burrow things.</p>
        <div class="ribbon">COMING SOON</div>
        <button class="pill" disabled>Soon‚Ñ¢</button>
      </section>
    </div>
  </div>

  <!-- Quick Add -->
  <div class="qa-overlay" id="qaOverlay" aria-hidden="true">
    <aside class="qa-sheet" role="dialog" aria-modal="true" aria-labelledby="qaTitle">
      <div class="qa-head"><div class="qa-grip"></div></div>
      <h2 id="qaTitle" class="qa-title" style="text-align:center;margin:10px 0 6px;font-weight:800;">Quick Add</h2>

      <form class="qa-form" id="qaForm" style="display:flex;flex-direction:column;gap:14px">
        <div class="qa-row" style="display:flex;gap:12px">
          <div style="flex:1">
            <label for="qaDate" style="display:block;font-size:13px;font-weight:700;margin-bottom:6px">Date</label>
            <input id="qaDate" type="date" required style="width:100%;font-size:16px;line-height:1.2;padding:14px 12px;border-radius:12px;border:1px solid #ddd">
          </div>
          <div style="flex:1">
            <label for="qaType" style="display:block;font-size:13px;font-weight:700;margin-bottom:6px">Type</label>
            <select id="qaType" required style="width:100%;font-size:16px;line-height:1.2;padding:14px 12px;border-radius:12px;border:1px solid #ddd"></select>
          </div>
        </div>

        <div class="qa-row" style="display:flex;gap:12px">
          <div style="flex:1">
            <label for="qaCat" style="display:block;font-size:13px;font-weight:700;margin-bottom:6px">Category</label>
            <select id="qaCat" required style="width:100%;font-size:16px;line-height:1.2;padding:14px 12px;border-radius:12px;border:1px solid #ddd"></select>
          </div>
          <div style="flex:1">
            <label for="qaAcct" style="display:block;font-size:13px;font-weight:700;margin-bottom:6px">Account</label>
            <select id="qaAcct" required style="width:100%;font-size:16px;line-height:1.2;padding:14px 12px;border-radius:12px;border:1px solid #ddd"></select>
          </div>
        </div>

        <div class="qa-row" style="display:flex;gap:12px">
          <div style="flex:1">
            <label for="qaAmt" style="display:block;font-size:13px;font-weight:700;margin-bottom:6px">Amount</label>
            <input id="qaAmt" type="number" step="0.01" placeholder="0.00" required style="width:100%;font-size:16px;line-height:1.2;padding:14px 12px;border-radius:12px;border:1px solid #ddd">
          </div>
          <div style="flex:1">
            <label for="qaDesc" style="display:block;font-size:13px;font-weight:700;margin-bottom:6px">Desc</label>
            <input id="qaDesc" type="text" placeholder="Optional" style="width:100%;font-size:16px;line-height:1.2;padding:14px 12px;border-radius:12px;border:1px solid #ddd">
          </div>
        </div>

        <div class="qa-actions" style="display:flex;gap:10px;justify-content:space-between;margin-top:2px">
          <button class="btn secondary" type="button" id="closeQA" style="border-radius:999px;padding:12px 16px;border:1px solid rgba(0,0,0,.06);background:#efe9e2;font-weight:800">Cancel</button>
          <button class="btn primary" type="submit" style="border-radius:999px;padding:12px 16px;border:1px solid rgba(0,0,0,.06);background:#ebd8c5;font-weight:800">Add</button>
        </div>
      </form>
    </aside>
  </div>

  <!-- ü•ï Easter Egg Overlay -->
<div class="egg-overlay" id="eggOverlay" aria-hidden="true">
  <aside class="egg-sheet" role="dialog" aria-modal="true" aria-labelledby="eggTitle">
    <div class="egg-head"><div class="egg-grip"></div></div>
    <h3 id="eggTitle" class="egg-title">BUNNY! WHAT ARE YOU DOING!! THIS IS A SECRET!!</h3>

    <p class="egg-body">
      You found the hidden burrow. ü§´<br>
      Claim your illicit reward:
    </p>

    <ul class="egg-perks">
      <li>+1 Mischief</li>
      <li>+3 Head Pats</li>
      <li>Unlimited carrot credit (terms absolutely do not apply)</li>
    </ul>

    <blockquote class="egg-quote">‚ÄúGood girrrrrl ‚ú® ‚Ä¶but also, you saw nothing.‚Äù</blockquote>

    <div class="egg-actions">
      <button class="btn primary" id="eggClose" type="button">I won‚Äôt tell ü´¢</button>
    </div>
  </aside>
</div>


  <script>
    const BASE_URL = '<?= BASE_URL ?>';

    // QA modal
    const overlay = document.getElementById('qaOverlay');
    const openBtn = document.getElementById('openQA');
    const closeBtn = document.getElementById('closeQA');

    function openSheet(){ overlay.classList.add('open'); overlay.setAttribute('aria-hidden','false'); setTimeout(()=>document.getElementById('qaDate')?.focus(),10); }
    function closeSheet(){ overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); }

    overlay.addEventListener('click', e => { if (e.target === overlay) closeSheet(); });
    openBtn.addEventListener('click', ()=>{ loadMeta(); openSheet(); });
    closeBtn.addEventListener('click', closeSheet);

    // Data loader (same backend as index)
    const elType = document.getElementById('qaType');
    const elCat  = document.getElementById('qaCat');
    const elAcct = document.getElementById('qaAcct');
    const elDate = document.getElementById('qaDate');
    const elAmt  = document.getElementById('qaAmt');
    const elDesc = document.getElementById('qaDesc');

    function fillSelect(sel, values = [], placeholder){
      sel.innerHTML = '';
      if (placeholder){
        const opt = document.createElement('option');
        opt.value = ''; opt.textContent = placeholder;
        sel.appendChild(opt);
      }
      values.forEach(v=>{
        const o=document.createElement('option');
        o.value=o.textContent=v;
        sel.appendChild(o);
      });
    }

    function loadMeta(){
      google.script.run.withSuccessHandler(({accounts, types})=>{
        fillSelect(elAcct, accounts, 'Choose account');
        fillSelect(elType, types, 'Choose type');
        const d=new Date(); elDate.value=new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,10);
        fillSelect(elCat, [], 'Choose category');
      }).getQuickAddMeta();
    }

    elType.addEventListener('change', ()=>{
      const t = elType.value;
      if (!t){ fillSelect(elCat, [], 'Choose category'); return; }
      google.script.run.withSuccessHandler(cats=>{
        fillSelect(elCat, cats, 'Choose category');
      }).listCategoriesByType(t);
    });

    document.getElementById('qaForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const payload={
        date: elDate.value,
        type: elType.value,
        category: elCat.value,
        amount: elAmt.value,
        account: elAcct.value,
        description: elDesc.value
      };
      openBtn.disabled = true;
      google.script.run
        .withSuccessHandler(()=>{ openBtn.disabled=false; closeSheet(); elAmt.value=''; elDesc.value=''; })
        .withFailureHandler(err=>{ openBtn.disabled=false; alert('Quick Add failed: ' + (err?.message || err)); })
        .quickAddTransaction(payload);
    });
  </script>

<script>
(() => {
  const bunny   = document.getElementById('eggBunny');
  const overlay = document.getElementById('eggOverlay');
  const close   = document.getElementById('eggClose');

  let taps = 0, timer = null;
  const WINDOW_MS = 1500;      // 7 taps within 1.5s
  let lastPointerId = null;    // avoid multi-fire on touchstart+click

  function reset() {
    taps = 0;
    if (timer) { clearTimeout(timer); timer = null; }
    lastPointerId = null;
  }
function openEgg() {
  overlay.classList.add('open');
  overlay.setAttribute('aria-hidden','false');

  // ‚õ® Ignore the first post-open tap so we don't insta-close
  overlay.dataset.armed = "0";
  setTimeout(() => { overlay.dataset.armed = "1"; }, 250);

  if (navigator.vibrate) navigator.vibrate(60);
}

  function closeEgg() {
    overlay.classList.remove('open');
    overlay.setAttribute('aria-hidden','true');
  }

  // Count taps on pointerdown (fast, mobile-friendly)
  function handleTap(ev){
    // Only primary finger/mouse
    if (ev.pointerType && ev.isPrimary === false) return;
    if (ev.button !== undefined && ev.button !== 0) return;

    // De-dupe touchstart‚Üíclick sequences
    if (ev.pointerId !== undefined) {
      if (lastPointerId === ev.pointerId) return;
      lastPointerId = ev.pointerId;
    }

    bunny.classList.add('bonk');
    setTimeout(() => bunny.classList.remove('bonk'), 160);

    taps++;
    if (!timer) timer = setTimeout(reset, WINDOW_MS);
    if (taps >= 7) { reset(); openEgg(); }
  }

  // Pointer events first; fall back to touchstart if needed
  if (window.PointerEvent) {
    bunny.addEventListener('pointerdown', handleTap, { passive: true });
  } else {
    bunny.addEventListener('touchstart', (e) => { handleTap(e); }, { passive: true });
    bunny.addEventListener('click', (e) => { handleTap(e); }); // desktop fallback
  }

overlay.addEventListener('click', (e) => {
  // If we just opened, ignore this tap
  if (overlay.dataset.armed !== "1") return;

  // Only close when the backdrop itself is tapped (not inside the dialog)
  if (e.target === overlay) closeEgg();
}, { passive: true });
  close.addEventListener('click', closeEgg);

  // Extra: prevent long-press text selection/context menu from being annoying
  bunny.addEventListener('contextmenu', (e)=> e.preventDefault());
})();
</script>

</body>
</html>
